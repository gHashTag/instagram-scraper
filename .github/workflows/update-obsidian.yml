name: üîÑ Update Obsidian Vault Daily

on:
  schedule:
    - cron: '0 6 * * *'
  workflow_dispatch:
    inputs:
      project_id:
        description: 'Project ID'
        default: '1'

jobs:
  update-vault:
    runs-on: ubuntu-latest
    steps:
      - name: üì• Checkout
        uses: actions/checkout@v4
      - name: üü¢ Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      - name: üì¶ Install dependencies
        run: npm install
      
      - name: üîç Debug environment
        run: |
          echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
          echo "TELEGRAM_BOT_TOKEN length: ${#TELEGRAM_BOT_TOKEN}"
          if [ -n "$TELEGRAM_BOT_TOKEN" ]; then
            echo "‚úÖ TELEGRAM_BOT_TOKEN —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–ø–µ—Ä–≤—ã–µ 10 —Å–∏–º–≤–æ–ª–æ–≤: ${TELEGRAM_BOT_TOKEN:0:10}...)"
          else
            echo "‚ùå TELEGRAM_BOT_TOKEN –ù–ï –£–°–¢–ê–ù–û–í–õ–ï–ù!"
          fi
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
      
      - name: üì± Send Telegram notification
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        run: |
          echo "üì± –û—Ç–ø—Ä–∞–≤–ª—è–µ–º Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ..."
          
          if [ -z "$TELEGRAM_BOT_TOKEN" ]; then
            echo "‚ùå –û–®–ò–ë–ö–ê: TELEGRAM_BOT_TOKEN –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ GitHub Secrets!"
            echo "üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:"
            echo "1. –ò–¥–∏—Ç–µ –≤ Settings ‚Üí Secrets and variables ‚Üí Actions"
            echo "2. –ù–∞–∂–º–∏—Ç–µ 'New repository secret'"
            echo "3. Name: TELEGRAM_BOT_TOKEN"
            echo "4. Value: –≤–∞—à —Ç–æ–∫–µ–Ω –±–æ—Ç–∞"
            exit 1
          fi
          
          echo "‚úÖ –¢–æ–∫–µ–Ω –Ω–∞–π–¥–µ–Ω, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ..."
          
          RESPONSE=$(curl -s -X POST "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage" \
            -d "chat_id=144022504" \
            -d "text=üéâ GitHub Actions —Ä–∞–±–æ—Ç–∞–µ—Ç! üîÑ Workflow –∑–∞–ø—É—â–µ–Ω —É—Å–ø–µ—à–Ω–æ.

          üìÖ –í—Ä–µ–º—è: $(date '+%d.%m.%Y %H:%M') UTC
          ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏–∑ GitHub Actions")
          
          echo "üì° –û—Ç–≤–µ—Ç Telegram API: $RESPONSE"
          
          if echo "$RESPONSE" | grep -q '"ok":true'; then
            echo "‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!"
          else
            echo "‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è!"
            echo "üîç –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞"
          fi
